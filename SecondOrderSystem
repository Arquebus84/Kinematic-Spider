using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class SecondOrderSystem : MonoBehaviour
{
    public Transform mass;
    public Transform basePos;

    [Header("Calculated Properties")]
    public float velocity = 0;
    public float distance_tm;   //Distance to the restLength
    public float force;
    public float x;

    [Header("Editable Properties")]
    public float acceleration;
    //public float damping;
    public float damping = 50f;
    public float bounce = 0.8f;

    //Using the equations for kinematics and spring force, implement a bouncy mass
    //  V_f^2 = V_i^2 + 2a(deltaX)
    //  F_spr = -k(deltaX)
    /**NOTE: The mass will follow 'this' transform whenever the user changes the current position of the object, therefore
                the mass is the geometry, and the target transform is this transform*/

    Vector3 _oldPosition;
    public void FixedUpdate()
    {

        distance_tm = Vector3.Distance(mass.position, basePos.position);
        //distance_tm = mass.position.y - transform.position.y;
        velocity = Mathf.Sqrt(2 * acceleration * distance_tm);

        //var damping = 12f;
        //var bounce = 0.9f;
        var oldPos = mass.position;

        mass.position = Vector3.Lerp(mass.position, basePos.position, velocity * (1 - bounce) * damping * Time.fixedDeltaTime);
        mass.position = (1 + bounce) * mass.position - bounce * _oldPosition;
        _oldPosition = oldPos;
    }
}
